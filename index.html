<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Party Jukebox - Collaborative Music Queue</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" onload="console.log('QRCode library loaded')" onerror="console.log('QRCode library failed to load')"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2" onload="console.log('Supabase library loaded')" onerror="loadSupabaseFromBackup()"></script>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>🎵 Party Jukebox</h1>
        <p>Collaborative Music Queue for Your Party</p>
    </div>

    <!-- Role Selection -->
    <div id="roleSelection" class="section">
        <div class="role-selector">
            <button class="role-btn host" onclick="setRole('host')">
                🎤 Host Party
            </button>
            <button class="role-btn guest" onclick="setRole('guest')">
                🎵 Join Party
            </button>
        </div>
        <div style="text-align: center; margin-top: 15px; opacity: 0.8;">
            <span id="currentUserName"></span>
        </div>
        <div style="text-align: center; margin-top: 10px; font-size: 0.9rem; opacity: 0.7;">
            <div id="roomStatus">Choose your role to get started</div>
        </div>
    </div>

    <!-- Host Setup -->
    <div id="hostSetup" class="section hidden">
        <div class="room-setup">
            <h2>🎉 Your Party Room</h2>
            <p>Share this code with your guests:</p>
            <div class="room-code" id="roomCode">PARTY123</div>
            <div class="qr-container">
                <div id="qrcode"></div>
            </div>
            <p>Or share this link:</p>
            <div id="shareLink" class="room-code" style="font-size: 1rem; word-break: break-all;"></div>
        </div>
    </div>

    <!-- Guest Join -->
    <div id="guestJoin" class="section hidden">
        <div class="join-section">
            <h2>🎵 Join the Party</h2>
            <p>Enter the party code:</p>
            <input type="text" id="joinCode" class="join-input" placeholder="PARTY123" maxlength="8">
            <button class="join-btn" onclick="joinRoom()">Join</button>
        </div>
    </div>

    <!-- Music Player (Host Only) -->
    <div id="playerSection" class="section hidden">
        <div class="player-section">
            <h2>🎵 Now Playing</h2>
            <div class="current-song">
                <div class="song-title" id="currentSongTitle">No song playing</div>
                <div id="player"></div>
            </div>
            <div class="player-controls">
                <button class="control-btn" onclick="previousSong()">⏮️ Previous</button>
                <button class="control-btn" onclick="togglePlayPause()" id="playPauseBtn">▶️ Play</button>
                <button class="control-btn" onclick="nextSong()">⏭️ Next</button>
            </div>
        </div>
    </div>

    <!-- Add Song Section -->
    <div id="addSongSection" class="section hidden">
        <div class="add-song-section">
            <h2>➕ Add a Song</h2>
            <div style="text-align: center; margin-bottom: 10px; opacity: 0.8; font-size: 0.9rem;">
                Adding as: <strong id="addingSongAs"></strong>
            </div>
            <div style="text-align: center; margin-bottom: 15px; opacity: 0.7; font-size: 0.8rem;">
                Room: <span id="currentRoomCode">Not connected</span>
            </div>
            <input type="text" id="songSearch" class="song-input" placeholder="Search for a song or paste YouTube URL...">
            <button class="add-btn" onclick="addSong()">Add to Queue</button>
        </div>
    </div>

    <!-- Queue Section -->
    <div id="queueSection" class="section hidden">
        <h2>🎵 Music Queue</h2>
        <div class="queue-list" id="queueList">
            <!-- Queue items will be added here -->
        </div>
    </div>

    <!-- Status Messages -->
    <div id="status" class="status hidden"></div>
</div>

<script src="app.js"></script>
</body>
</html>